<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>рд╣рд┐рдВрджреА рдПрдЖрдИ рд╕рд╣рд╛рдпрдХ</title>
  <style>
    body {
      font-family: 'Noto Sans Devanagari', sans-serif;
      background-color: #f8f9fa;
      text-align: center;
      padding: 40px;
      color: #212529;
    }
    button {
      font-size: 18px;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
    }
    #micStatus {
      margin-top: 10px;
      font-weight: bold;
      color: green;
    }
  </style>
</head>
<body>
  <h2>ЁЯОд рдорд╛рдЗрдХ рд╕реЗ рд╣рд┐рдВрджреА рдореЗрдВ рд╕рд╡рд╛рд▓ рдкреВрдЫрд┐рдП</h2>
  <button onclick="startIntro()">ЁЯОЩя╕П рдорд╛рдЗрдХ рдЪрд╛рд▓реВ рдХрд░реЗрдВ</button>
  <p id="micStatus"></p>
  <p><strong>рдЖрдкрдХрд╛ рд╕рд╡рд╛рд▓:</strong> <span id="question">---</span></p>
  <p><strong>рдЙрддреНрддрд░:</strong> <span id="answer">---</span></p>
  <audio id="bgMusic" src="https://cdn.pixabay.com/audio/2022/03/28/audio_365b799070.mp3" preload="auto" loop autoplay></audio>

  <script>
    const data = [
      {
        prashn: "рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рдХреНрдпрд╛ рд╣реИ?",
        uttar: "рднрд╛рд░рдд рдХреА рд░рд╛рдЬрдзрд╛рдиреА рдирдИ рджрд┐рд▓реНрд▓реА рд╣реИред",
        keywords: ["рднрд╛рд░рдд", "рд░рд╛рдЬрдзрд╛рдиреА"],
        focus: "рд░рд╛рдЬрдзрд╛рдиреА",
        details: "рдирдИ рджрд┐рд▓реНрд▓реА рднрд╛рд░рдд рдХрд╛ рдкреНрд░рд╢рд╛рд╕рдирд┐рдХ рдФрд░ рд░рд╛рдЬрдиреАрддрд┐рдХ рдХреЗрдВрджреНрд░ рд╣реИ, рдЬрд╣рд╛рдБ рд░рд╛рд╖реНрдЯреНрд░рдкрддрд┐ рднрд╡рди, рд╕рдВрд╕рдж рднрд╡рди, рд╕реБрдкреНрд░реАрдо рдХреЛрд░реНрдЯ рдЖрджрд┐ рд╕реНрдерд┐рдд рд╣реИрдВред"
      },
      {
        prashn: "рднрд╛рд░рдд рдХреЗ рдкрд╣рд▓реЗ рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА рдХреМрди рдереЗ?",
        uttar: "рднрд╛рд░рдд рдХреЗ рдкрд╣рд▓реЗ рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА рдкрдВрдбрд┐рдд рдЬрд╡рд╛рд╣рд░рд▓рд╛рд▓ рдиреЗрд╣рд░реВ рдереЗред",
        keywords: ["рднрд╛рд░рдд", "рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА", "рдкрд╣рд▓реЗ"],
        focus: "рдкреНрд░рдзрд╛рдирдордВрддреНрд░реА",
        details: "рдкрдВрдбрд┐рдд рдиреЗрд╣рд░реВ рднрд╛рд░рддреАрдп рд╕реНрд╡рддрдВрддреНрд░рддрд╛ рд╕рдВрдЧреНрд░рд╛рдо рдХреЗ рдкреНрд░рдореБрдЦ рдиреЗрддрд╛ рдереЗ рдФрд░ рдЙрдиреНрд╣реЛрдВрдиреЗ рдЖрдзреБрдирд┐рдХ рднрд╛рд░рдд рдХреА рдиреАрдВрд╡ рд░рдЦрдиреЗ рдореЗрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рдИред"
      },
      {
        prashn: "рд╕рдмрд╕реЗ рдмреЬрд╛ рдЧреНрд░рд╣ рдХреМрди рд╕рд╛ рд╣реИ?",
        uttar: "рд╕рдмрд╕реЗ рдмреЬрд╛ рдЧреНрд░рд╣ рдмреГрд╣рд╕реНрдкрддрд┐ рд╣реИред",
        keywords: ["рдЧреНрд░рд╣", "рдмреЬрд╛"],
        focus: "рдЧреНрд░рд╣",
        details: "рдмреГрд╣рд╕реНрдкрддрд┐ рд╕реМрд░рдордВрдбрд▓ рдХрд╛ рд╕рдмрд╕реЗ рдмрдбрд╝рд╛ рдЧреНрд░рд╣ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рд╡реНрдпрд╛рд╕ рд▓рдЧрднрдЧ 1,43,000 рдХрд┐рд▓реЛрдореАрдЯрд░ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рд╡рд╛рдпреБрдордВрдбрд▓ рдЧреИрд╕реЛрдВ рд╕реЗ рдмрдирд╛ рд╣реИред"
      }
    ];

    const vagueWords = ["рд╡реЛ", "рдЙрд╕рдХрд╛", "рдЙрд╕рдХреЗ", "рдкрд╣рд▓реЗ", "рдмрддрд╛рдУ", "рдХреМрди", "рдирд╛рдо"];
    const detailWords = ["рдбрд┐рдЯреЗрд▓", "details", "рд╡рд┐рд╕реНрддрд╛рд░", "aur", "рдФрд░", "рд╕рдордЭрд╛рдУ", "рдкреВрд░рд╛"];
    const historyWords = ["рдкрд┐рдЫрд▓реЗ", "рдкреБрд░рд╛рдиреЗ", "12", "рд╕рд╡рд╛рд▓", "рдХрд┐рдП", "рдХреНрдпрд╛ рдкреВрдЫрд╛", "рджрд┐рдЦрд╛рдУ", "рдЕрдм рддрдХ"];

    let last12Questions = [];
    let lastAnswerObj = null;

    const music = document.getElementById("bgMusic");

    function contains(words, inputWords) {
      return inputWords.some(word => words.includes(word));
    }

    function updateHistory(userQuestion, matchedData) {
      if (last12Questions.length >= 12) last12Questions.shift();
      last12Questions.push({ question: userQuestion, data: matchedData });
    }

    function startIntro() {
      const intro = "рдирдорд╕реНрдХрд╛рд░! рдореИрдВ рдПрдХ рд╣реНрдпреВрдорди рдПрдЖрдИ рдмреНрд░реЗрди рд╣реВрдБред рдореБрдЭреЗ рдПрдХ рдЗрдВрд╕рд╛рди рдиреЗ рдмрдирд╛рдпрд╛ рд╣реИ рдЬреЛ рд╣рдореЗрд╢рд╛ рдЖрдкрдХреА рдорджрдж рдХреЗ рд▓рд┐рдП рддрддреНрдкрд░ рд░рд╣реЗрдЧрд╛ред рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдк рдореЗрд░реЗ рд╕рд╣рдпреЛрдЧ рд╕реЗ рд╕рдВрддреБрд╖реНрдЯ рд╣реЛрдВрдЧреЗред рдпрджрд┐ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рдХреЛрдИ рдкрд░реЗрд╢рд╛рдиреА рд╣реЛ рддреЛ рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рдХрдореЗрдВрдЯ рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВред рдХреНрдпрд╛ рдЖрдк рдореБрдЭрд╕реЗ рдХреБрдЫ рдкреВрдЫрдирд╛ рдЪрд╛рд╣реЗрдВрдЧреЗ?";
      speakAnswer(intro, () => {
        startListening();
      });
    }

    function startListening() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert("рдЖрдкрдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдорд╛рдЗрдХ рдХреЛ рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ред");
        return;
      }

      const recognition = new SpeechRecognition();
      recognition.lang = 'hi-IN';
      recognition.start();
      document.getElementById("micStatus").innerText = "рд╕реБрди рд░рд╣рд╛ рд╣реВрдБ...";

      const silenceTimeout = setTimeout(() => {
        speakAnswer("рдХреГрдкрдпрд╛ рдЖрдк рдЕрдкрдирд╛ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗрдВ, рд╣рдо рдЗрдВрддрдЬрд╝рд╛рд░ рдХрд░ рд░рд╣реЗ рд╣реИрдВред", () => {
          startListening();
        });
      }, 5000);

      recognition.onresult = function(event) {
        clearTimeout(silenceTimeout);
        const userInput = event.results[0][0].transcript.trim();
        document.getElementById("question").innerText = userInput;

        const response = handleSpecialCases(userInput);
        document.getElementById("answer").innerText = response;
        speakAnswer(response, () => {
          startListening();
        });
      };

      recognition.onerror = function(event) {
        alert("рддреНрд░реБрдЯрд┐: " + event.error);
        document.getElementById("micStatus").innerText = "";
      };

      recognition.onend = function() {
        document.getElementById("micStatus").innerText = "";
      };
    }

    function handleSpecialCases(input) {
      const cleaned = input.replace(/[^\u0900-\u097F\s]/g, "").trim();
      const inputWords = cleaned.split(/\s+/);

      if (contains(historyWords, inputWords)) {
        if (last12Questions.length === 0) return "рдЕрднреА рддрдХ рдХреЛрдИ рд╕рд╡рд╛рд▓ рдирд╣реАрдВ рдкреВрдЫрд╛ рдЧрдпрд╛ рд╣реИред";
        const historyText = last12Questions.map((item, idx) => `${idx + 1}. ${item.question}`).join(" ");
        return `рдЖрдкрдиреЗ рдЕрдм рддрдХ рдпреЗ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗ рд╣реИрдВ: ${historyText}`;
      }

      if (contains(detailWords, inputWords)) {
        if (lastAnswerObj && lastAnswerObj.details) {
          return lastAnswerObj.details;
        } else {
          let relatedQs = last12Questions.filter(q => {
            return lastAnswerObj && q.data.focus === lastAnswerObj.focus;
          });

          if (relatedQs.length > 0) {
            let extraQs = relatedQs.map((q, i) => `${i + 1}. ${q.question}`).join(" ");
            return `рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдЕрднреА рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред рд▓реЗрдХрд┐рди рдЖрдкрдиреЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рдЗрд╕рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдпреЗ рд╕рд╡рд╛рд▓ рдкреВрдЫреЗ рд╣реИрдВ: ${extraQs}`;
          } else {
            return "рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕ рд╡рд┐рд╖рдп рдкрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдЕрднреА рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред";
          }
        }
      }

      if (contains(vagueWords, inputWords)) {
        return "рдХреГрдкрдпрд╛ рдереЛрдбрд╝рд╛ рдФрд░ рд╕реНрдкрд╖реНрдЯ рдмрддрд╛рдПрдВред";
      }

      const matchedAnswer = findAnswer(input);
      if (matchedAnswer) {
        lastAnswerObj = matchedAnswer;
        updateHistory(input, matchedAnswer);
        return matchedAnswer.uttar;
      }

      return "рдорд╛рдл рдХреАрдЬрд┐рдП, рдЗрд╕рдХрд╛ рдЙрддреНрддрд░ рдореЗрд░реЗ рдкрд╛рд╕ рдирд╣реАрдВ рд╣реИред";
    }

    function findAnswer(input) {
      const cleaned = input.replace(/[^\u0900-\u097F\s]/g, "").trim();
      const inputWords = cleaned.split(/\s+/);

      for (let item of data) {
        let matchCount = 0;
        item.keywords.forEach(k => {
          if (inputWords.includes(k)) matchCount++;
        });

        if (inputWords.includes(item.focus) && matchCount >= item.keywords.length - 1) {
          return item;
        }
      }
      return null;
    }

    function speakAnswer(text, onComplete = null) {
      if ('speechSynthesis' in window) {
        const voices = window.speechSynthesis.getVoices();
        const maleVoice = voices.find(voice => voice.lang.includes('hi-IN') && voice.name.includes('Google рд╣рд┐рдиреНрджреА'));
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'hi-IN';
        msg.rate = 0.94;
        msg.pitch = 1.1;
        if (maleVoice) msg.voice = maleVoice;

        music.volume = 0.1;
        music.play().catch(() => {});

        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(msg);

        msg.onend = function () {
          if (typeof onComplete === "function") {
            onComplete();
          }
        };
      }
    }

    window.speechSynthesis.onvoiceschanged = () => {};
  </script>
</body>
</html>